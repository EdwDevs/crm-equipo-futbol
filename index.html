<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>‚≠ê IMPERIO ANDINO - Champions Edition</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  :root {
    /* Champions League Colors - Navy Blue Base con Rainbow Accents */
    --champions-navy: #001e47;
    --champions-darkblue: #002b5c;
    --champions-blue: #0066cc;
    --champions-cyan: #00bfff;
    --champions-purple: #8b00ff;
    --champions-pink: #ff006e;
    --champions-orange: #ff6b00;
    --champions-yellow: #ffd700;
    --champions-green: #00ff88;
    
    --primary: var(--champions-navy);
    --primary-dark: var(--champions-darkblue);
    --secondary: var(--champions-blue);
    --success: #28a745;
    --danger: #dc3545;
    --warning: #ffc107;
    --info: #17a2b8;
    --light: #f8f9fa;
    --dark: #0a1628;
    --border: #ddd;
    --shadow: rgba(0, 30, 71, 0.3);
    --container-width: 500px;
    --padding: 10px;
    --font-base: 14px;
    --header-size: 24px;
  }
  
  @media (min-width: 768px) {
    :root {
      --container-width: 1100px;
      --padding: 20px;
      --font-base: 15px;
      --header-size: 28px;
    }
  }
  
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, var(--champions-navy) 0%, var(--champions-darkblue) 50%, var(--champions-blue) 100%);
    min-height: 100vh;
    padding: var(--padding);
    color: var(--dark);
    font-size: var(--font-base);
    line-height: 1.6;
    position: relative;
    overflow-x: hidden;
  }
  
  /* Efecto de estrellas animadas (Champions League starball inspired) */
  body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
      radial-gradient(2px 2px at 20% 30%, rgba(255, 215, 0, 0.4), transparent),
      radial-gradient(2px 2px at 60% 70%, rgba(0, 191, 255, 0.4), transparent),
      radial-gradient(1px 1px at 50% 50%, rgba(139, 0, 255, 0.3), transparent),
      radial-gradient(1px 1px at 80% 10%, rgba(255, 0, 110, 0.3), transparent),
      radial-gradient(2px 2px at 90% 60%, rgba(0, 255, 136, 0.3), transparent),
      radial-gradient(1px 1px at 33% 80%, rgba(255, 107, 0, 0.3), transparent);
    background-size: 200% 200%;
    animation: starfield 20s ease-in-out infinite;
    pointer-events: none;
    z-index: 0;
  }
  
  @keyframes starfield {
    0%, 100% { background-position: 0% 0%; }
    50% { background-position: 100% 100%; }
  }
  
  .container {
    max-width: var(--container-width);
    margin: 0 auto;
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 40px rgba(0, 30, 71, 0.5);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    max-height: 95vh;
    position: relative;
    z-index: 1;
    border: 3px solid transparent;
    background-clip: padding-box;
  }
  
  /* Efecto de borde multicolor (prism effect) */
  .container::before {
    content: "";
    position: absolute;
    top: -3px;
    left: -3px;
    right: -3px;
    bottom: -3px;
    background: linear-gradient(45deg, 
      var(--champions-cyan), 
      var(--champions-purple), 
      var(--champions-pink), 
      var(--champions-orange), 
      var(--champions-yellow), 
      var(--champions-green),
      var(--champions-cyan)
    );
    background-size: 300% 300%;
    border-radius: 15px;
    z-index: -1;
    animation: prismaticGlow 8s ease infinite;
  }
  
  @keyframes prismaticGlow {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }
  
  .header {
    background: linear-gradient(135deg, var(--champions-navy) 0%, var(--champions-blue) 100%);
    color: white;
    padding: clamp(20px, 4vw, 30px);
    text-align: center;
    flex-shrink: 0;
    position: relative;
    overflow: hidden;
  }
  
  /* Efecto de luz refractada en el header */
  .header::before {
    content: "";
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, 
      transparent 30%, 
      rgba(0, 191, 255, 0.1) 40%, 
      rgba(139, 0, 255, 0.1) 45%, 
      rgba(255, 0, 110, 0.1) 50%, 
      transparent 60%
    );
    animation: refraction 10s linear infinite;
  }
  
  @keyframes refraction {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .header h1 { 
    font-size: clamp(24px, 6vw, 36px);
    margin-bottom: 8px;
    font-weight: 900;
    letter-spacing: 2px;
    text-transform: uppercase;
    position: relative;
    z-index: 1;
    text-shadow: 
      2px 2px 0 rgba(0, 191, 255, 0.5),
      -2px -2px 0 rgba(255, 0, 110, 0.5);
  }
  
  .header .team-name {
    font-size: clamp(20px, 5vw, 28px);
    font-weight: 700;
    margin-top: 5px;
    background: linear-gradient(90deg, 
      var(--champions-cyan), 
      var(--champions-yellow), 
      var(--champions-pink),
      var(--champions-cyan)
    );
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: gradientShift 5s ease infinite;
  }
  
  @keyframes gradientShift {
    0%, 100% { background-position: 0% center; }
    50% { background-position: 100% center; }
  }
  
  .header p {
    font-size: calc(var(--font-base) * 0.95);
    opacity: 0.95;
    position: relative;
    z-index: 1;
    margin-top: 8px;
  }
  
  /* Estrella Champions League decorativa */
  .champions-star {
    position: absolute;
    width: 30px;
    height: 30px;
    top: 15px;
    right: 15px;
    opacity: 0.9;
    font-size: 30px;
    animation: twinkle 2s ease-in-out infinite;
    z-index: 2;
  }
  
  @keyframes twinkle {
    0%, 100% { opacity: 1; transform: scale(1) rotate(0deg); }
    50% { opacity: 0.6; transform: scale(1.2) rotate(180deg); }
  }
  
  .nav-tabs {
    display: flex;
    flex-wrap: wrap;
    background: var(--light);
    border-bottom: 2px solid var(--border);
    flex-shrink: 0;
  }
  
  .tab {
    flex: 1;
    min-width: 80px;
    padding: 12px 8px;
    text-align: center;
    background: var(--light);
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: calc(var(--font-base) * 0.9);
    font-weight: 600;
    color: var(--dark);
    border-bottom: 3px solid transparent;
    position: relative;
    overflow: hidden;
  }
  
  .tab:hover {
    background: #e9ecef;
    color: var(--secondary);
  }
  
  .tab.active {
    background: white;
    color: var(--secondary);
    border-bottom: 3px solid var(--secondary);
  }
  
  .tab.active::before {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, 
      var(--champions-cyan), 
      var(--champions-purple), 
      var(--champions-pink)
    );
    animation: tabGlow 2s ease infinite;
  }
  
  @keyframes tabGlow {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }
  
  .tab-content {
    flex: 1;
    overflow-y: auto;
    padding: var(--padding);
    scrollbar-width: thin;
    scrollbar-color: var(--secondary) var(--light);
  }
  
  .tab-content::-webkit-scrollbar {
    width: 8px;
  }
  
  .tab-content::-webkit-scrollbar-track {
    background: var(--light);
  }
  
  .tab-content::-webkit-scrollbar-thumb {
    background: var(--secondary);
    border-radius: 4px;
  }
  
  .tab-content::-webkit-scrollbar-thumb:hover {
    background: var(--primary);
  }
  
  .tab-pane {
    display: none;
  }
  
  .tab-pane.active {
    display: block;
  }
  
  .form-group {
    margin-bottom: 15px;
  }
  
  label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: var(--dark);
    font-size: calc(var(--font-base) * 0.95);
  }
  
  input[type="text"],
  input[type="number"],
  input[type="date"],
  select,
  textarea {
    width: 100%;
    padding: 10px;
    border: 2px solid var(--border);
    border-radius: 8px;
    font-size: var(--font-base);
    transition: all 0.3s ease;
    background: white;
  }
  
  input[type="text"]:focus,
  input[type="number"]:focus,
  input[type="date"]:focus,
  select:focus,
  textarea:focus {
    outline: none;
    border-color: var(--secondary);
    box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
  }
  
  textarea {
    resize: vertical;
    min-height: 80px;
  }
  
  .btn {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: var(--font-base);
    font-weight: 600;
    transition: all 0.3s ease;
    text-align: center;
    display: inline-block;
    margin: 5px 2px;
  }
  
  .btn-primary {
    background: linear-gradient(135deg, var(--secondary), var(--primary));
    color: white;
    box-shadow: 0 4px 12px rgba(0, 102, 204, 0.3);
  }
  
  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0, 102, 204, 0.4);
  }
  
  .btn-success {
    background: var(--success);
    color: white;
  }
  
  .btn-success:hover {
    background: #218838;
    transform: translateY(-2px);
  }
  
  .btn-danger {
    background: var(--danger);
    color: white;
  }
  
  .btn-danger:hover {
    background: #c82333;
    transform: translateY(-2px);
  }
  
  .btn-secondary {
    background: #6c757d;
    color: white;
  }
  
  .btn-secondary:hover {
    background: #5a6268;
    transform: translateY(-2px);
  }
  
  .btn-sm {
    padding: 6px 12px;
    font-size: calc(var(--font-base) * 0.85);
  }
  
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px var(--shadow);
  }
  
  th {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    padding: 12px;
    text-align: left;
    font-weight: 700;
    font-size: calc(var(--font-base) * 0.95);
  }
  
  td {
    padding: 10px 12px;
    border-bottom: 1px solid var(--border);
    font-size: var(--font-base);
  }
  
  tr:hover {
    background: #f8f9fa;
  }
  
  tr:last-child td {
    border-bottom: none;
  }
  
  .player-item,
  .match-item {
    background: white;
    padding: 12px;
    margin-bottom: 10px;
    border-radius: 8px;
    border-left: 4px solid var(--secondary);
    box-shadow: 0 2px 6px var(--shadow);
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
  }
  
  .player-item:hover,
  .match-item:hover {
    transform: translateX(5px);
    box-shadow: 0 4px 12px var(--shadow);
  }
  
  .player-info,
  .match-info {
    flex: 1;
  }
  
  .player-actions,
  .match-actions {
    display: flex;
    gap: 5px;
  }
  
  .badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: calc(var(--font-base) * 0.85);
    font-weight: 600;
    margin: 2px;
  }
  
  .badge-success {
    background: #d4edda;
    color: #155724;
  }
  
  .badge-danger {
    background: #f8d7da;
    color: #721c24;
  }
  
  .badge-warning {
    background: #fff3cd;
    color: #856404;
  }
  
  .badge-info {
    background: #d1ecf1;
    color: #0c5460;
  }
  
  .alert {
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 15px;
    font-size: var(--font-base);
  }
  
  .alert-info {
    background: #d1ecf1;
    border: 1px solid #bee5eb;
    color: #0c5460;
  }
  
  .alert-success {
    background: #d4edda;
    border: 1px solid #c3e6cb;
    color: #155724;
  }
  
  .alert-warning {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    color: #856404;
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 20px 0;
  }
  
  .stat-card {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 12px var(--shadow);
    text-align: center;
    border-top: 4px solid var(--secondary);
    transition: all 0.3s ease;
  }
  
  .stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 16px var(--shadow);
  }
  
  .stat-card h3 {
    font-size: calc(var(--font-base) * 1.1);
    color: var(--dark);
    margin-bottom: 10px;
  }
  
  .stat-card .stat-value {
    font-size: calc(var(--font-base) * 2);
    font-weight: 900;
    color: var(--secondary);
    display: block;
    margin: 10px 0;
  }
  
  .stat-card .stat-label {
    font-size: calc(var(--font-base) * 0.9);
    color: #666;
  }
  
  .checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 10px 0;
  }
  
  .checkbox-label {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 8px 12px;
    background: var(--light);
    border: 2px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .checkbox-label:hover {
    background: #e9ecef;
    border-color: var(--secondary);
  }
  
  .checkbox-label input[type="checkbox"] {
    cursor: pointer;
    width: 18px;
    height: 18px;
  }
  
  .filter-controls {
    background: var(--light);
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
  }
  
  .filter-controls input,
  .filter-controls select {
    flex: 1;
    min-width: 150px;
  }
  
  .filter-controls button {
    flex-shrink: 0;
  }
  
  .section-title {
    font-size: calc(var(--font-base) * 1.3);
    font-weight: 700;
    color: var(--primary);
    margin: 20px 0 15px;
    padding-bottom: 10px;
    border-bottom: 3px solid var(--secondary);
    position: relative;
  }
  
  .section-title::after {
    content: "";
    position: absolute;
    bottom: -3px;
    left: 0;
    width: 100px;
    height: 3px;
    background: linear-gradient(90deg, 
      var(--champions-cyan), 
      var(--champions-purple)
    );
  }
  
  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #999;
  }
  
  .empty-state-icon {
    font-size: 48px;
    margin-bottom: 15px;
    opacity: 0.5;
  }
  
  @media (max-width: 768px) {
    .player-item,
    .match-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
    }
    
    .player-actions,
    .match-actions {
      width: 100%;
      justify-content: flex-start;
    }
    
    .btn {
      padding: 8px 15px;
      font-size: calc(var(--font-base) * 0.9);
    }
    
    table {
      font-size: calc(var(--font-base) * 0.85);
    }
    
    th, td {
      padding: 8px 6px;
    }
    
    .stats-grid {
      grid-template-columns: 1fr;
    }
  }
  
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(5px);
  }
  
  .modal-content {
    background: white;
    margin: 5% auto;
    padding: 0;
    border-radius: 15px;
    max-width: 600px;
    max-height: 85vh;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    animation: modalSlideIn 0.3s ease;
  }
  
  @keyframes modalSlideIn {
    from {
      transform: translateY(-50px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
  
  .modal-header {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .modal-header h2 {
    margin: 0;
    font-size: calc(var(--font-base) * 1.4);
  }
  
  .close {
    color: white;
    font-size: 32px;
    font-weight: bold;
    cursor: pointer;
    line-height: 1;
    transition: all 0.3s ease;
  }
  
  .close:hover {
    transform: rotate(90deg);
  }
  
  .modal-body {
    padding: 20px;
    overflow-y: auto;
    max-height: calc(85vh - 140px);
  }
  
  .modal-footer {
    padding: 15px 20px;
    border-top: 1px solid var(--border);
    display: flex;
    justify-content: flex-end;
    gap: 10px;
  }

  /* NUEVOS ESTILOS PARA TABLA DE DEUDAS */
  .debt-table {
    width: 100%;
    margin-top: 20px;
    border-collapse: separate;
    border-spacing: 0;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0, 30, 71, 0.2);
  }

  .debt-table thead {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
  }

  .debt-table thead th {
    color: white;
    font-weight: 700;
    padding: 15px;
    text-align: center;
    font-size: calc(var(--font-base) * 1.05);
  }

  .debt-table tbody tr {
    transition: all 0.3s ease;
    background: white;
  }

  .debt-table tbody tr:nth-child(even) {
    background: #f8f9fa;
  }

  .debt-table tbody tr:hover {
    background: #e3f2fd;
    transform: scale(1.02);
    box-shadow: 0 2px 8px rgba(0, 102, 204, 0.2);
  }

  .debt-table tbody td {
    padding: 12px;
    text-align: center;
    border-bottom: 1px solid #dee2e6;
  }

  .debt-table tbody tr:last-child td {
    border-bottom: none;
  }

  .debt-highlight {
    font-weight: 700;
    font-size: calc(var(--font-base) * 1.1);
  }

  .debt-amount {
    color: var(--danger);
    font-weight: 900;
    font-size: calc(var(--font-base) * 1.2);
  }

  .debt-paid {
    color: var(--success);
  }

  .player-name-cell {
    text-align: left !important;
    font-weight: 600;
    color: var(--primary);
  }

  .debt-summary-card {
    background: linear-gradient(135deg, #fff, #f8f9fa);
    border-left: 5px solid var(--danger);
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .debt-summary-card h3 {
    color: var(--primary);
    margin-bottom: 15px;
    font-size: calc(var(--font-base) * 1.3);
  }

  .debt-summary-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 15px;
  }

  .debt-stat-item {
    text-align: center;
    padding: 10px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  }

  .debt-stat-label {
    font-size: calc(var(--font-base) * 0.9);
    color: #666;
    margin-bottom: 5px;
  }

  .debt-stat-value {
    font-size: calc(var(--font-base) * 1.5);
    font-weight: 900;
    color: var(--danger);
  }

  .no-debt {
    text-align: center;
    padding: 40px;
    color: var(--success);
    font-size: calc(var(--font-base) * 1.2);
    font-weight: 600;
  }

  .no-debt-icon {
    font-size: 64px;
    margin-bottom: 20px;
  }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="champions-star">‚≠ê</div>
    <h1>‚öΩ GESTI√ìN DE TORNEO</h1>
    <div class="team-name">IMPERIO ANDINO</div>
    <p>Champions Edition - Sistema de Gesti√≥n Integral</p>
  </div>

  <div class="nav-tabs">
    <button class="tab active" onclick="switchTab('jugadores')">üë• Jugadores</button>
    <button class="tab" onclick="switchTab('partidos')">‚öΩ Partidos</button>
    <button class="tab" onclick="switchTab('estadisticas')">üìä Estad√≠sticas</button>
    <button class="tab" onclick="switchTab('finanzas')">üí∞ Finanzas</button>
    <button class="tab" onclick="switchTab('configuracion')">‚öôÔ∏è Config</button>
  </div>

  <div class="tab-content">
    <!-- TAB: JUGADORES -->
    <div id="jugadores" class="tab-pane active">
      <h2 class="section-title">Gesti√≥n de Jugadores</h2>
      
      <div class="form-group">
        <button class="btn btn-primary" onclick="openAddPlayerModal()">‚ûï Agregar Jugador</button>
      </div>

      <div class="filter-controls">
        <input type="text" id="playerFilter" placeholder="üîç Buscar por nombre o n√∫mero..." oninput="filterPlayers()">
        <select id="playerSortBy" onchange="sortPlayers()">
          <option value="name">Ordenar por Nombre</option>
          <option value="number">Ordenar por N√∫mero</option>
          <option value="paid">Ordenar por Pagado</option>
        </select>
        <button class="btn btn-secondary btn-sm" onclick="clearPlayerFilters()">üóëÔ∏è Limpiar</button>
      </div>

      <div id="playersList"></div>
    </div>

    <!-- TAB: PARTIDOS -->
    <div id="partidos" class="tab-pane">
      <h2 class="section-title">Gesti√≥n de Partidos</h2>
      
      <div class="form-group">
        <button class="btn btn-primary" onclick="openAddMatchModal()">‚ûï Registrar Partido</button>
      </div>

      <div class="filter-controls">
        <input type="text" id="matchFilter" placeholder="üîç Buscar partidos..." oninput="filterMatches()">
        <select id="matchSortBy" onchange="sortMatches()">
          <option value="date">Ordenar por Fecha (m√°s reciente)</option>
          <option value="dateOld">Ordenar por Fecha (m√°s antiguo)</option>
          <option value="result">Ordenar por Resultado</option>
        </select>
        <button class="btn btn-secondary btn-sm" onclick="clearMatchFilters()">üóëÔ∏è Limpiar</button>
      </div>

      <div id="matchesList"></div>
    </div>

    <!-- TAB: ESTAD√çSTICAS -->
    <div id="estadisticas" class="tab-pane">
      <h2 class="section-title">Estad√≠sticas del Equipo</h2>
      
      <div class="stats-grid">
        <div class="stat-card">
          <h3>üèÜ Partidos Jugados</h3>
          <span class="stat-value" id="totalMatchesPlayed">0</span>
          <span class="stat-label">Total</span>
        </div>
        <div class="stat-card">
          <h3>‚úÖ Victorias</h3>
          <span class="stat-value" id="totalWins">0</span>
          <span class="stat-label">Ganados</span>
        </div>
        <div class="stat-card">
          <h3>‚ùå Derrotas</h3>
          <span class="stat-value" id="totalLosses">0</span>
          <span class="stat-label">Perdidos</span>
        </div>
        <div class="stat-card">
          <h3>ü§ù Empates</h3>
          <span class="stat-value" id="totalDraws">0</span>
          <span class="stat-label">Empatados</span>
        </div>
      </div>

      <h3 class="section-title">üìã Tabla General</h3>
      <table id="generalStatsTable">
        <thead>
          <tr>
            <th>Estad√≠stica</th>
            <th>Total</th>
            <th>Promedio/Porcentaje</th>
          </tr>
        </thead>
        <tbody id="generalStatsBody"></tbody>
      </table>

      <h3 class="section-title">üë§ Estad√≠sticas por Jugador</h3>
      
      <div class="filter-controls">
        <input type="text" id="playerStatsFilter" placeholder="üîç Buscar jugador..." oninput="filterPlayerStats()">
        <select id="playerStatsSortBy" onchange="sortPlayerStats()">
          <option value="matches">Ordenar por Partidos</option>
          <option value="goals">Ordenar por Goles</option>
          <option value="avgGoals">Ordenar por Promedio de Goles</option>
          <option value="yellowCards">Ordenar por Tarjetas Amarillas</option>
          <option value="blueCards">Ordenar por Tarjetas Azules</option>
          <option value="redCards">Ordenar por Tarjetas Rojas</option>
          <option value="attendance">Ordenar por Asistencia</option>
        </select>
        <button class="btn btn-secondary btn-sm" onclick="clearPlayerStatsFilters()">üóëÔ∏è Limpiar</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>Jugador</th>
            <th>#</th>
            <th>PJ</th>
            <th>Asistencia</th>
            <th>Goles</th>
            <th>Prom. Goles</th>
            <th>üü®</th>
            <th>üü¶</th>
            <th>üü•</th>
            <th>Total Tarjetas</th>
            <th>Prom. Tarjetas</th>
          </tr>
        </thead>
        <tbody id="playerStatsTable"></tbody>
      </table>
    </div>

    <!-- TAB: FINANZAS -->
    <div id="finanzas" class="tab-pane">
      <h2 class="section-title">üí∞ Control Financiero</h2>
      
      <div class="stats-grid">
        <div class="stat-card">
          <h3>üíµ Total Recaudado</h3>
          <span class="stat-value" id="totalCollected">$0</span>
          <span class="stat-label">Inscripciones pagadas</span>
        </div>
        <div class="stat-card">
          <h3>üéØ Meta Inscripci√≥n</h3>
          <span class="stat-value" id="totalInscriptionNeeded">$0</span>
          <span class="stat-label">Total requerido</span>
        </div>
        <div class="stat-card">
          <h3>‚öΩ Gasto en √Årbitros</h3>
          <span class="stat-value" id="totalRefereeSpent">$0</span>
          <span class="stat-label">Total gastado</span>
        </div>
        <div class="stat-card">
          <h3>‚úÖ √Årbitros Pagados</h3>
          <span class="stat-value" id="totalRefereeCollected">$0</span>
          <span class="stat-label">Recaudado de jugadores</span>
        </div>
        <div class="stat-card">
          <h3>‚è≥ √Årbitros Pendientes</h3>
          <span class="stat-value" id="totalRefereePending">$0</span>
          <span class="stat-label">Por cobrar</span>
        </div>
      </div>

      <div class="alert alert-info" id="inscriptionInfo"></div>

      <!-- NUEVA SECCI√ìN: DEUDAS POR JUGADOR -->
      <h3 class="section-title">üìã Deudas por Jugador</h3>
      
      <div id="debtSummarySection"></div>
      
      <div id="debtTableContainer"></div>
    </div>

    <!-- TAB: CONFIGURACI√ìN -->
    <div id="configuracion" class="tab-pane">
      <h2 class="section-title">‚öôÔ∏è Configuraci√≥n del Torneo</h2>
      
      <div class="form-group">
        <label>Nombre del Torneo</label>
        <input type="text" id="tournamentName" placeholder="Ej: Copa Champions 2024">
      </div>

      <div class="form-group">
        <label>Inscripci√≥n por Jugador (COP)</label>
        <input type="number" id="inscriptionPerPlayer" placeholder="Ej: 50000">
      </div>

      <div class="form-group">
        <label>Inscripci√≥n Total del Torneo (COP)</label>
        <input type="number" id="totalInscription" placeholder="Ej: 500000">
      </div>

      <div class="form-group">
        <label>N√∫mero de Partidos Manuales (no registrados en el sistema)</label>
        <input type="number" id="manualMatches" placeholder="Ej: 3" min="0">
      </div>

      <div class="form-group">
        <button class="btn btn-success" onclick="saveTournamentConfig()">üíæ Guardar Configuraci√≥n</button>
      </div>

      <hr style="margin: 30px 0; border: 1px solid var(--border);">

      <h3 class="section-title">üì§ Exportar / Importar Datos</h3>
      
      <div class="form-group">
        <button class="btn btn-primary" onclick="exportData()">üì• Exportar Datos (JSON)</button>
        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">üì§ Importar Datos</button>
        <input type="file" id="importFile" style="display: none;" accept=".json" onchange="importData(event)">
      </div>

      <div class="form-group">
        <button class="btn btn-danger" onclick="resetAllData()">üóëÔ∏è Resetear Todos los Datos</button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL: Agregar/Editar Jugador -->
<div id="playerModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="playerModalTitle">Agregar Jugador</h2>
      <span class="close" onclick="closePlayerModal()">&times;</span>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Nombre del Jugador *</label>
        <input type="text" id="playerName" placeholder="Ej: Juan P√©rez">
      </div>
      <div class="form-group">
        <label>N√∫mero de Camiseta *</label>
        <input type="number" id="playerNumber" placeholder="Ej: 10" min="1">
      </div>
      <div class="form-group">
        <label>Inscripci√≥n Pagada (COP)</label>
        <input type="number" id="playerPaid" placeholder="Ej: 50000" min="0">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closePlayerModal()">Cancelar</button>
      <button class="btn btn-primary" onclick="savePlayer()">Guardar</button>
    </div>
  </div>
</div>

<!-- MODAL: Agregar/Editar Partido -->
<div id="matchModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="matchModalTitle">Registrar Partido</h2>
      <span class="close" onclick="closeMatchModal()">&times;</span>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Fecha del Partido *</label>
        <input type="date" id="matchDate">
      </div>
      <div class="form-group">
        <label>Rival *</label>
        <input type="text" id="matchRival" placeholder="Ej: Deportivo Cali">
      </div>
      <div class="form-group">
        <label>Goles a Favor *</label>
        <input type="number" id="matchGoalsFor" placeholder="0" min="0" value="0">
      </div>
      <div class="form-group">
        <label>Goles en Contra *</label>
        <input type="number" id="matchGoalsAgainst" placeholder="0" min="0" value="0">
      </div>
      <div class="form-group">
        <label>Tarjetas Amarillas</label>
        <input type="number" id="matchYellowCards" placeholder="0" min="0" value="0">
      </div>
      <div class="form-group">
        <label>Tarjetas Azules</label>
        <input type="number" id="matchBlueCards" placeholder="0" min="0" value="0">
      </div>
      <div class="form-group">
        <label>Tarjetas Rojas</label>
        <input type="number" id="matchRedCards" placeholder="0" min="0" value="0">
      </div>
      <div class="form-group">
        <label>Costo de √Årbitro (COP)</label>
        <input type="number" id="matchRefereeCost" placeholder="Ej: 40000" min="0" value="0">
      </div>
      <div class="form-group">
        <label>Costo de √Årbitro por Jugador (COP)</label>
        <input type="number" id="matchRefereePerPlayer" placeholder="Ej: 2000" min="0" value="0">
      </div>
      <div class="form-group">
        <label>Jugadores Presentes *</label>
        <div id="matchPlayersList" class="checkbox-group"></div>
      </div>
      <div class="form-group">
        <label>Notas del Partido</label>
        <textarea id="matchNotes" placeholder="Ej: Gran partido, dominio total..."></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeMatchModal()">Cancelar</button>
      <button class="btn btn-primary" onclick="saveMatch()">Guardar</button>
    </div>
  </div>
</div>

<!-- MODAL: Detalles del Partido -->
<div id="matchDetailsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>üìã Detalles del Partido</h2>
      <span class="close" onclick="closeMatchDetailsModal()">&times;</span>
    </div>
    <div class="modal-body" id="matchDetailsContent"></div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeMatchDetailsModal()">Cerrar</button>
    </div>
  </div>
</div>

<script>
  // Variables globales
  let tournamentData = {
    name: "Torneo Champions",
    inscriptionPerPlayer: 0,
    totalInscription: 0,
    manualMatches: 0,
    players: [],
    matches: []
  };

  let players = [];
  let matches = [];
  let filteredPlayers = [];
  let filteredMatches = [];
  let filteredPlayerStats = [];
  let editingPlayerId = null;
  let editingMatchId = null;
  let currentTournament = "torneo1";

  // Funciones de utilidad
  function generateId() {
    return Date.now().toString(36) + Math.random().toString(36).substr(2);
  }

  function saveToLocalStorage() {
    localStorage.setItem(currentTournament, JSON.stringify(tournamentData));
  }

  function loadFromLocalStorage() {
    const data = localStorage.getItem(currentTournament);
    if (data) {
      tournamentData = JSON.parse(data);
      players = tournamentData.players || [];
      matches = tournamentData.matches || [];
    }
  }

  // Funciones de navegaci√≥n
  function switchTab(tabName) {
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
    
    event.target.classList.add('active');
    document.getElementById(tabName).classList.add('active');
    
    if (tabName === 'estadisticas') {
      updateStatistics();
    } else if (tabName === 'finanzas') {
      updateStatistics();
      updateDebtTable(); // NUEVA FUNCI√ìN
    } else if (tabName === 'configuracion') {
      loadConfigForm();
    }
  }

  // GESTI√ìN DE JUGADORES
  function openAddPlayerModal() {
    editingPlayerId = null;
    document.getElementById('playerModalTitle').textContent = 'Agregar Jugador';
    document.getElementById('playerName').value = '';
    document.getElementById('playerNumber').value = '';
    document.getElementById('playerPaid').value = '';
    document.getElementById('playerModal').style.display = 'block';
  }

  function closePlayerModal() {
    document.getElementById('playerModal').style.display = 'none';
  }

  function savePlayer() {
    const name = document.getElementById('playerName').value.trim();
    const number = parseInt(document.getElementById('playerNumber').value);
    const paid = parseFloat(document.getElementById('playerPaid').value) || 0;

    if (!name || !number) {
      alert('Por favor completa todos los campos obligatorios');
      return;
    }

    if (editingPlayerId) {
      const player = players.find(p => p.id === editingPlayerId);
      player.name = name;
      player.number = number;
      player.totalPaid = paid;
    } else {
      const newPlayer = {
        id: generateId(),
        name,
        number,
        totalPaid: paid
      };
      players.push(newPlayer);
    }

    tournamentData.players = players;
    saveToLocalStorage();
    updatePlayersList();
    closePlayerModal();
  }

  function editPlayer(playerId) {
    const player = players.find(p => p.id === playerId);
    if (!player) return;

    editingPlayerId = playerId;
    document.getElementById('playerModalTitle').textContent = 'Editar Jugador';
    document.getElementById('playerName').value = player.name;
    document.getElementById('playerNumber').value = player.number;
    document.getElementById('playerPaid').value = player.totalPaid || 0;
    document.getElementById('playerModal').style.display = 'block';
  }

  function deletePlayer(playerId) {
    if (!confirm('¬øEst√°s seguro de eliminar este jugador?')) return;
    
    players = players.filter(p => p.id !== playerId);
    tournamentData.players = players;
    saveToLocalStorage();
    updatePlayersList();
  }

  function updatePlayersList() {
    const container = document.getElementById('playersList');
    
    if (filteredPlayers.length === 0) {
      container.innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon">üë§</div>
          <p>No hay jugadores registrados</p>
        </div>
      `;
      return;
    }

    container.innerHTML = filteredPlayers.map(player => {
      const inscriptionPerPlayer = tournamentData.inscriptionPerPlayer || 0;
      const remaining = inscriptionPerPlayer - (player.totalPaid || 0);
      const statusBadge = remaining <= 0 
        ? '<span class="badge badge-success">‚úÖ Pagado</span>'
        : `<span class="badge badge-danger">‚ùå Debe: $${remaining.toFixed(0)}</span>`;

      return `
        <div class="player-item">
          <div class="player-info">
            <strong>${player.name}</strong> - #${player.number}
            <br>
            <small>Pagado: $${(player.totalPaid || 0).toFixed(0)} / $${inscriptionPerPlayer.toFixed(0)}</small>
            ${statusBadge}
          </div>
          <div class="player-actions">
            <button class="btn btn-sm btn-primary" onclick="editPlayer('${player.id}')">‚úèÔ∏è Editar</button>
            <button class="btn btn-sm btn-danger" onclick="deletePlayer('${player.id}')">üóëÔ∏è</button>
          </div>
        </div>
      `;
    }).join('');
  }

  function filterPlayers() {
    const searchTerm = document.getElementById('playerFilter').value.toLowerCase();
    filteredPlayers = players.filter(player => {
      const nameMatch = player.name.toLowerCase().includes(searchTerm);
      const numberMatch = player.number.toString().includes(searchTerm);
      return nameMatch || numberMatch;
    });
    sortPlayers();
  }

  function sortPlayers() {
    const sortBy = document.getElementById('playerSortBy').value;
    filteredPlayers.sort((a, b) => {
      switch(sortBy) {
        case 'name':
          return a.name.localeCompare(b.name);
        case 'number':
          return a.number - b.number;
        case 'paid':
          return (b.totalPaid || 0) - (a.totalPaid || 0);
        default:
          return 0;
      }
    });
    updatePlayersList();
  }

  function clearPlayerFilters() {
    document.getElementById('playerFilter').value = '';
    document.getElementById('playerSortBy').value = 'name';
    filteredPlayers = [...players];
    updatePlayersList();
  }

  // GESTI√ìN DE PARTIDOS
  function openAddMatchModal() {
    editingMatchId = null;
    document.getElementById('matchModalTitle').textContent = 'Registrar Partido';
    document.getElementById('matchDate').value = new Date().toISOString().split('T')[0];
    document.getElementById('matchRival').value = '';
    document.getElementById('matchGoalsFor').value = '0';
    document.getElementById('matchGoalsAgainst').value = '0';
    document.getElementById('matchYellowCards').value = '0';
    document.getElementById('matchBlueCards').value = '0';
    document.getElementById('matchRedCards').value = '0';
    document.getElementById('matchRefereeCost').value = '0';
    document.getElementById('matchRefereePerPlayer').value = '0';
    document.getElementById('matchNotes').value = '';
    
    updateMatchPlayersList();
    document.getElementById('matchModal').style.display = 'block';
  }

  function closeMatchModal() {
    document.getElementById('matchModal').style.display = 'none';
  }

  function updateMatchPlayersList() {
    const container = document.getElementById('matchPlayersList');
    
    if (players.length === 0) {
      container.innerHTML = '<p style="color: #999;">No hay jugadores registrados</p>';
      return;
    }

    container.innerHTML = players.map(player => `
      <label class="checkbox-label">
        <input type="checkbox" class="match-player-checkbox" value="${player.id}">
        ${player.name} (#${player.number})
      </label>
    `).join('');
  }

  function saveMatch() {
    const date = document.getElementById('matchDate').value;
    const rival = document.getElementById('matchRival').value.trim();
    const goalsFor = parseInt(document.getElementById('matchGoalsFor').value) || 0;
    const goalsAgainst = parseInt(document.getElementById('matchGoalsAgainst').value) || 0;
    const yellowCards = parseInt(document.getElementById('matchYellowCards').value) || 0;
    const blueCards = parseInt(document.getElementById('matchBlueCards').value) || 0;
    const redCards = parseInt(document.getElementById('matchRedCards').value) || 0;
    const refereeCost = parseFloat(document.getElementById('matchRefereeCost').value) || 0;
    const refereePerPlayer = parseFloat(document.getElementById('matchRefereePerPlayer').value) || 0;
    const notes = document.getElementById('matchNotes').value.trim();

    if (!date || !rival) {
      alert('Por favor completa la fecha y el rival');
      return;
    }

    const checkboxes = document.querySelectorAll('.match-player-checkbox:checked');
    const presentPlayers = Array.from(checkboxes).map(cb => cb.value);

    if (presentPlayers.length === 0) {
      alert('Selecciona al menos un jugador presente');
      return;
    }

    let result = 'draw';
    if (goalsFor > goalsAgainst) result = 'win';
    else if (goalsFor < goalsAgainst) result = 'loss';

    const matchData = {
      id: editingMatchId || generateId(),
      date,
      rival,
      goalsFor,
      goalsAgainst,
      result,
      yellowCards,
      blueCards,
      redCards,
      refereeCost,
      refereePerPlayer,
      presentPlayers,
      notes,
      refereePayments: {}
    };

    presentPlayers.forEach(playerId => {
      matchData.refereePayments[playerId] = false;
    });

    if (editingMatchId) {
      const index = matches.findIndex(m => m.id === editingMatchId);
      matches[index] = matchData;
    } else {
      matches.push(matchData);
    }

    tournamentData.matches = matches;
    saveToLocalStorage();
    updateMatchesList();
    closeMatchModal();
  }

  function updateMatchesList() {
    const container = document.getElementById('matchesList');
    
    if (filteredMatches.length === 0) {
      container.innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon">‚öΩ</div>
          <p>No hay partidos registrados</p>
        </div>
      `;
      return;
    }

    container.innerHTML = filteredMatches.map(match => {
      let resultBadge = '';
      if (match.result === 'win') resultBadge = '<span class="badge badge-success">‚úÖ Victoria</span>';
      else if (match.result === 'loss') resultBadge = '<span class="badge badge-danger">‚ùå Derrota</span>';
      else resultBadge = '<span class="badge badge-warning">ü§ù Empate</span>';

      return `
        <div class="match-item">
          <div class="match-info">
            <strong>${match.date}</strong> - vs ${match.rival}
            <br>
            Resultado: ${match.goalsFor} - ${match.goalsAgainst} ${resultBadge}
            <br>
            <small>Jugadores: ${match.presentPlayers.length} | √Årbitro: $${match.refereeCost.toFixed(0)}</small>
          </div>
          <div class="match-actions">
            <button class="btn btn-sm btn-primary" onclick="showMatchDetails('${match.id}')">üëÅÔ∏è Ver</button>
            <button class="btn btn-sm btn-danger" onclick="deleteMatch('${match.id}')">üóëÔ∏è</button>
          </div>
        </div>
      `;
    }).join('');
  }

  function deleteMatch(matchId) {
    if (!confirm('¬øEst√°s seguro de eliminar este partido?')) return;
    
    matches = matches.filter(m => m.id !== matchId);
    tournamentData.matches = matches;
    saveToLocalStorage();
    updateMatchesList();
  }

  function showMatchDetails(matchId) {
    const match = matches.find(m => m.id === matchId);
    if (!match) return;

    const presentPlayersDetails = match.presentPlayers.map(playerId => {
      const player = players.find(p => p.id === playerId);
      if (!player) return '';
      
      const refereePaid = match.refereePayments && match.refereePayments[playerId];
      const badgeClass = refereePaid ? 'badge-success' : 'badge-danger';
      const badgeText = refereePaid ? '‚úÖ Pag√≥ √°rbitro' : '‚ùå Debe √°rbitro';
      
      return `<li>${player.name} (#${player.number}) <span class="badge ${badgeClass}">${badgeText}</span></li>`;
    }).join('');

    let resultText = '';
    if (match.result === 'win') resultText = '<span class="badge badge-success">‚úÖ VICTORIA</span>';
    else if (match.result === 'loss') resultText = '<span class="badge badge-danger">‚ùå DERROTA</span>';
    else resultText = '<span class="badge badge-warning">ü§ù EMPATE</span>';

    const content = `
      <h3>üìÖ ${match.date} - vs ${match.rival}</h3>
      <p><strong>Resultado:</strong> ${match.goalsFor} - ${match.goalsAgainst} ${resultText}</p>
      
      <h4>üìä Estad√≠sticas</h4>
      <ul>
        <li><strong>Goles a favor:</strong> ${match.goalsFor}</li>
        <li><strong>Goles en contra:</strong> ${match.goalsAgainst}</li>
        <li><strong>Tarjetas amarillas:</strong> ${match.yellowCards}</li>
        <li><strong>Tarjetas azules:</strong> ${match.blueCards}</li>
        <li><strong>Tarjetas rojas:</strong> ${match.redCards}</li>
      </ul>

      <h4>üí∞ Informaci√≥n de √Årbitro</h4>
      <ul>
        <li><strong>Costo total:</strong> $${match.refereeCost.toFixed(0)}</li>
        <li><strong>Por jugador:</strong> $${match.refereePerPlayer.toFixed(0)}</li>
      </ul>

      <h4>üë• Jugadores Presentes (${match.presentPlayers.length})</h4>
      <ul>${presentPlayersDetails}</ul>

      ${match.notes ? `<h4>üìù Notas</h4><p>${match.notes}</p>` : ''}
    `;

    document.getElementById('matchDetailsContent').innerHTML = content;
    document.getElementById('matchDetailsModal').style.display = 'block';
  }

  function closeMatchDetailsModal() {
    document.getElementById('matchDetailsModal').style.display = 'none';
  }

  function filterMatches() {
    const searchTerm = document.getElementById('matchFilter').value.toLowerCase();
    filteredMatches = matches.filter(match => {
      const rivalMatch = match.rival.toLowerCase().includes(searchTerm);
      const dateMatch = match.date.includes(searchTerm);
      return rivalMatch || dateMatch;
    });
    sortMatches();
  }

  function sortMatches() {
    const sortBy = document.getElementById('matchSortBy').value;
    filteredMatches.sort((a, b) => {
      switch(sortBy) {
        case 'date':
          return new Date(b.date) - new Date(a.date);
        case 'dateOld':
          return new Date(a.date) - new Date(b.date);
        case 'result':
          const resultOrder = { win: 0, draw: 1, loss: 2 };
          return resultOrder[a.result] - resultOrder[b.result];
        default:
          return 0;
      }
    });
    updateMatchesList();
  }

  function clearMatchFilters() {
    document.getElementById('matchFilter').value = '';
    document.getElementById('matchSortBy').value = 'date';
    filteredMatches = [...matches];
    updateMatchesList();
  }

  // ESTAD√çSTICAS
  function updateStatistics() {
    const stats = {
      totalMatches: matches.length,
      wins: matches.filter(m => m.result === 'win').length,
      draws: matches.filter(m => m.result === 'draw').length,
      losses: matches.filter(m => m.result === 'loss').length,
      goalsScored: matches.reduce((sum, m) => sum + m.goalsFor, 0),
      goalsConceded: matches.reduce((sum, m) => sum + m.goalsAgainst, 0),
      yellowCards: matches.reduce((sum, m) => sum + (m.yellowCards || 0), 0),
      blueCards: matches.reduce((sum, m) => sum + (m.blueCards || 0), 0),
      redCards: matches.reduce((sum, m) => sum + (m.redCards || 0), 0),
      totalReferee: matches.reduce((sum, m) => sum + (m.refereeCost || 0), 0)
    };

    document.getElementById('totalMatchesPlayed').textContent = stats.totalMatches;
    document.getElementById('totalWins').textContent = stats.wins;
    document.getElementById('totalLosses').textContent = stats.losses;
    document.getElementById('totalDraws').textContent = stats.draws;

    const totalMatches = stats.totalMatches || 1;
    const winPercent = (stats.wins / totalMatches) * 100;
    const drawPercent = (stats.draws / totalMatches) * 100;
    const lossPercent = (stats.losses / totalMatches) * 100;
    const avgGoalsScored = stats.goalsScored / totalMatches;
    const avgGoalsConceded = stats.goalsConceded / totalMatches;
    const goalDifference = stats.goalsScored - stats.goalsConceded;
    const totalCards = stats.yellowCards + stats.blueCards + stats.redCards;
    const avgCards = totalCards / totalMatches;

    document.getElementById('generalStatsBody').innerHTML = `
      <tr style="background: #d4edda;">
        <td><strong>‚úÖ Victorias</strong></td>
        <td>${stats.wins || 0}</td>
        <td>${winPercent.toFixed(1)}%</td>
      </tr>
      <tr style="background: #fff3cd;">
        <td><strong>ü§ù Empates</strong></td>
        <td>${stats.draws || 0}</td>
        <td>${drawPercent.toFixed(1)}%</td>
      </tr>
      <tr style="background: #f8d7da;">
        <td><strong>‚ùå Derrotas</strong></td>
        <td>${stats.losses || 0}</td>
        <td>${lossPercent.toFixed(1)}%</td>
      </tr>
      <tr>
        <td><strong>‚öΩ Goles Anotados</strong></td>
        <td>${stats.goalsScored || 0}</td>
        <td>${avgGoalsScored.toFixed(2)} goles/partido</td>
      </tr>
      <tr>
        <td><strong>ü•Ö Goles Recibidos</strong></td>
        <td>${stats.goalsConceded || 0}</td>
        <td>${avgGoalsConceded.toFixed(2)} goles/partido</td>
      </tr>
      <tr style="background: ${goalDifference >= 0 ? '#d4edda' : '#f8d7da'};">
        <td><strong>üìä Diferencia de Goles</strong></td>
        <td>${goalDifference >= 0 ? '+' : ''}${goalDifference}</td>
        <td>-</td>
      </tr>
      <tr style="background: #fff3cd;">
        <td><strong>üü® Tarjetas Amarillas</strong></td>
        <td>${stats.yellowCards || 0}</td>
        <td>${totalMatches > 0 ? ((stats.yellowCards || 0) / totalMatches).toFixed(2) : 0} por partido</td>
      </tr>
      <tr style="background: #d1ecf1;">
        <td><strong>üü¶ Tarjetas Azules</strong></td>
        <td>${stats.blueCards || 0}</td>
        <td>${totalMatches > 0 ? ((stats.blueCards || 0) / totalMatches).toFixed(2) : 0} por partido</td>
      </tr>
      <tr style="background: #f8d7da;">
        <td><strong>üü• Tarjetas Rojas</strong></td>
        <td>${stats.redCards || 0}</td>
        <td>${totalMatches > 0 ? ((stats.redCards || 0) / totalMatches).toFixed(2) : 0} por partido</td>
      </tr>
      <tr>
        <td><strong>üìã Total Tarjetas</strong></td>
        <td>${totalCards}</td>
        <td>${avgCards.toFixed(2)} por partido</td>
      </tr>
    `;
    
    // Calcular estad√≠sticas por jugador
    const playerStatsMap = new Map();
    
    players.forEach(player => {
      playerStatsMap.set(player.id, {
        id: player.id,
        name: player.name,
        number: player.number,
        matchesPlayed: 0,
        goals: 0,
        yellowCards: 0,
        blueCards: 0,
        redCards: 0
      });
    });
    
    matches.forEach(match => {
      if (match.presentPlayers) {
        match.presentPlayers.forEach(playerId => {
          if (playerStatsMap.has(playerId)) {
            const playerStat = playerStatsMap.get(playerId);
            playerStat.matchesPlayed++;
            
            // Sumar estad√≠sticas individuales si existen
            if (match.playerStats && match.playerStats[playerId]) {
              const stats = match.playerStats[playerId];
              playerStat.goals += stats.goals || 0;
              playerStat.yellowCards += stats.yellowCards || 0;
              playerStat.blueCards += stats.blueCards || 0;
              playerStat.redCards += stats.redCards || 0;
            }
          }
        });
      }
    });
    
    filteredPlayerStats = Array.from(playerStatsMap.values());
    sortPlayerStats();
    
    // Finanzas
    const totalPaid = players.reduce((sum, p) => sum + (p.totalPaid || 0), 0);
    document.getElementById("totalCollected").textContent = `$${totalPaid.toFixed(0)}`;
    document.getElementById("totalInscriptionNeeded").textContent = `$${(tournamentData.totalInscription || 0).toFixed(0)}`;
    document.getElementById("totalRefereeSpent").textContent = `$${(stats.totalReferee || 0).toFixed(0)}`;
    
    let totalRefereeCollected = 0;
    let totalRefereePending = 0;
    
    matches.forEach(match => {
      if (match.refereePayments) {
        const paidCount = Object.values(match.refereePayments).filter(paid => paid).length;
        const pendingCount = match.presentPlayers.length - paidCount;
        
        totalRefereeCollected += paidCount * match.refereePerPlayer;
        totalRefereePending += pendingCount * match.refereePerPlayer;
      }
    });
    
    document.getElementById("totalRefereeCollected").textContent = `$${totalRefereeCollected.toFixed(0)}`;
    document.getElementById("totalRefereePending").textContent = `$${totalRefereePending.toFixed(0)}`;
  }

  function updatePlayerStatsTable() {
    const tbody = document.getElementById("playerStatsTable");
    const totalMatches = (tournamentData.matches || []).length + (tournamentData.manualMatches || 0);
    
    if (filteredPlayerStats.length === 0) {
      tbody.innerHTML = '<tr><td colspan="11" style="text-align: center; color: #999; padding: 20px;">No hay estad√≠sticas de jugadores</td></tr>';
      return;
    }
    
    tbody.innerHTML = filteredPlayerStats.map(player => {
      const avgGoals = player.matchesPlayed > 0 ? (player.goals / player.matchesPlayed).toFixed(2) : '0.00';
      const totalCards = player.yellowCards + player.blueCards + player.redCards;
      const avgCards = player.matchesPlayed > 0 ? (totalCards / player.matchesPlayed).toFixed(2) : '0.00';
      const attendancePercent = totalMatches > 0 ? ((player.matchesPlayed / totalMatches) * 100).toFixed(1) : '0.0';
      
      return `
        <tr>
          <td><strong>${player.name}</strong></td>
          <td>${player.number}</td>
          <td>${player.matchesPlayed}</td>
          <td>
            <span class="badge ${attendancePercent >= 80 ? 'badge-success' : attendancePercent >= 50 ? 'badge-warning' : 'badge-danger'}">
              ${attendancePercent}%
            </span>
          </td>
          <td><strong style="color: var(--success);">${player.goals}</strong></td>
          <td>${avgGoals}</td>
          <td>${player.yellowCards}</td>
          <td>${player.blueCards}</td>
          <td>${player.redCards}</td>
          <td><strong>${totalCards}</strong></td>
          <td>${avgCards}</td>
        </tr>
      `;
    }).join('');
  }

  window.filterPlayerStats = function() {
    const searchTerm = document.getElementById("playerStatsFilter").value.toLowerCase();
    
    const playerStatsMap = new Map();
    
    players.forEach(player => {
      playerStatsMap.set(player.id, {
        id: player.id,
        name: player.name,
        number: player.number,
        matchesPlayed: 0,
        goals: 0,
        yellowCards: 0,
        blueCards: 0,
        redCards: 0
      });
    });
    
    const matches = tournamentData.matches || [];
    
    matches.forEach(match => {
      if (match.presentPlayers) {
        match.presentPlayers.forEach(playerId => {
          if (playerStatsMap.has(playerId)) {
            const playerStat = playerStatsMap.get(playerId);
            playerStat.matchesPlayed++;
            
            if (match.playerStats && match.playerStats[playerId]) {
              const stats = match.playerStats[playerId];
              playerStat.goals += stats.goals || 0;
              playerStat.yellowCards += stats.yellowCards || 0;
              playerStat.blueCards += stats.blueCards || 0;
              playerStat.redCards += stats.redCards || 0;
            }
          }
        });
      }
    });
    
    filteredPlayerStats = Array.from(playerStatsMap.values()).filter(player => {
      const nameMatch = player.name.toLowerCase().includes(searchTerm);
      const numberMatch = player.number.toString().includes(searchTerm);
      return nameMatch || numberMatch;
    });
    
    sortPlayerStats();
  };

  window.sortPlayerStats = function() {
    const sortBy = document.getElementById("playerStatsSortBy").value;
    const totalMatches = (tournamentData.matches || []).length + (tournamentData.manualMatches || 0);
    
    filteredPlayerStats.sort((a, b) => {
      switch(sortBy) {
        case 'matches':
          return b.matchesPlayed - a.matchesPlayed;
        case 'goals':
          return b.goals - a.goals;
        case 'avgGoals':
          const avgA = a.matchesPlayed > 0 ? a.goals / a.matchesPlayed : 0;
          const avgB = b.matchesPlayed > 0 ? b.goals / b.matchesPlayed : 0;
          return avgB - avgA;
        case 'yellowCards':
          return b.yellowCards - a.yellowCards;
        case 'blueCards':
          return b.blueCards - a.blueCards;
        case 'redCards':
          return b.redCards - a.redCards;
        case 'attendance':
          const attA = totalMatches > 0 ? a.matchesPlayed / totalMatches : 0;
          const attB = totalMatches > 0 ? b.matchesPlayed / totalMatches : 0;
          return attB - attA;
        default:
          return 0;
      }
    });
    
    updatePlayerStatsTable();
  };

  window.clearPlayerStatsFilters = function() {
    document.getElementById("playerStatsFilter").value = "";
    document.getElementById("playerStatsSortBy").value = "matches";
    filterPlayerStats();
  };

  // ========== NUEVA FUNCI√ìN: TABLA DE DEUDAS ==========
  function updateDebtTable() {
    const debtSummarySection = document.getElementById('debtSummarySection');
    const debtTableContainer = document.getElementById('debtTableContainer');
    
    // Calcular deudas por jugador agrupadas
    const playerDebtsMap = new Map();
    
    // Primero agrupar jugadores por nombre o n√∫mero
    players.forEach(player => {
      // Crear clave √∫nica basada en nombre normalizado
      const normalizedName = player.name.trim().toLowerCase();
      
      if (!playerDebtsMap.has(normalizedName)) {
        playerDebtsMap.set(normalizedName, {
          name: player.name, // Usar el nombre original del primer registro
          numbers: new Set([player.number]),
          totalPaid: 0,
          inscriptionDebt: 0,
          refereeDebt: 0,
          totalDebt: 0,
          playerIds: []
        });
      }
      
      const debt = playerDebtsMap.get(normalizedName);
      debt.numbers.add(player.number);
      debt.totalPaid += (player.totalPaid || 0);
      debt.playerIds.push(player.id);
    });
    
    // Calcular deudas de inscripci√≥n
    const inscriptionPerPlayer = tournamentData.inscriptionPerPlayer || 0;
    playerDebtsMap.forEach((debt, key) => {
      const expectedInscription = inscriptionPerPlayer * debt.playerIds.length;
      debt.inscriptionDebt = Math.max(0, expectedInscription - debt.totalPaid);
    });
    
    // Calcular deudas de √°rbitro
    matches.forEach(match => {
      if (match.presentPlayers && match.refereePayments) {
        match.presentPlayers.forEach(playerId => {
          const player = players.find(p => p.id === playerId);
          if (!player) return;
          
          const normalizedName = player.name.trim().toLowerCase();
          const debt = playerDebtsMap.get(normalizedName);
          
          if (debt && !match.refereePayments[playerId]) {
            debt.refereeDebt += match.refereePerPlayer || 0;
          }
        });
      }
    });
    
    // Calcular deuda total
    playerDebtsMap.forEach(debt => {
      debt.totalDebt = debt.inscriptionDebt + debt.refereeDebt;
    });
    
    // Convertir a array y ordenar por deuda total (mayor a menor)
    const debtsArray = Array.from(playerDebtsMap.values())
      .sort((a, b) => b.totalDebt - a.totalDebt);
    
    // Calcular totales
    const totalInscriptionDebt = debtsArray.reduce((sum, d) => sum + d.inscriptionDebt, 0);
    const totalRefereeDebt = debtsArray.reduce((sum, d) => sum + d.refereeDebt, 0);
    const totalDebt = debtsArray.reduce((sum, d) => sum + d.totalDebt, 0);
    const playersWithDebt = debtsArray.filter(d => d.totalDebt > 0).length;
    
    // Mostrar resumen si hay deudas
    if (totalDebt > 0) {
      debtSummarySection.innerHTML = `
        <div class="debt-summary-card">
          <h3>üí° Resumen de Deudas</h3>
          <div class="debt-summary-stats">
            <div class="debt-stat-item">
              <div class="debt-stat-label">üë• Jugadores con Deuda</div>
              <div class="debt-stat-value">${playersWithDebt}</div>
            </div>
            <div class="debt-stat-item">
              <div class="debt-stat-label">üíµ Deuda Inscripci√≥n</div>
              <div class="debt-stat-value">$${totalInscriptionDebt.toFixed(0)}</div>
            </div>
            <div class="debt-stat-item">
              <div class="debt-stat-label">‚öΩ Deuda √Årbitros</div>
              <div class="debt-stat-value">$${totalRefereeDebt.toFixed(0)}</div>
            </div>
            <div class="debt-stat-item">
              <div class="debt-stat-label">üí∞ Deuda Total</div>
              <div class="debt-stat-value">$${totalDebt.toFixed(0)}</div>
            </div>
          </div>
        </div>
      `;
      
      // Generar tabla de deudas
      const debtRows = debtsArray
        .filter(debt => debt.totalDebt > 0)
        .map(debt => {
          const numbersDisplay = Array.from(debt.numbers).sort((a, b) => a - b).join(', ');
          
          return `
            <tr>
              <td class="player-name-cell">${debt.name}</td>
              <td>#${numbersDisplay}</td>
              <td class="debt-paid">$${debt.totalPaid.toFixed(0)}</td>
              <td class="debt-amount">$${debt.inscriptionDebt.toFixed(0)}</td>
              <td class="debt-amount">$${debt.refereeDebt.toFixed(0)}</td>
              <td class="debt-amount debt-highlight">$${debt.totalDebt.toFixed(0)}</td>
            </tr>
          `;
        }).join('');
      
      debtTableContainer.innerHTML = `
        <table class="debt-table">
          <thead>
            <tr>
              <th>üë§ Jugador</th>
              <th>üî¢ N√∫mero(s)</th>
              <th>‚úÖ Pagado</th>
              <th>üíµ Deuda Inscripci√≥n</th>
              <th>‚öΩ Deuda √Årbitros</th>
              <th>üí∞ Total a Pagar</th>
            </tr>
          </thead>
          <tbody>
            ${debtRows}
          </tbody>
        </table>
      `;
    } else {
      debtSummarySection.innerHTML = '';
      debtTableContainer.innerHTML = `
        <div class="no-debt">
          <div class="no-debt-icon">üéâ</div>
          <p>¬°Excelente! No hay deudas pendientes</p>
        </div>
      `;
    }
  }

  // CONFIGURACI√ìN
  function loadConfigForm() {
    document.getElementById('tournamentName').value = tournamentData.name || '';
    document.getElementById('inscriptionPerPlayer').value = tournamentData.inscriptionPerPlayer || 0;
    document.getElementById('totalInscription').value = tournamentData.totalInscription || 0;
    document.getElementById('manualMatches').value = tournamentData.manualMatches || 0;
    updateInscriptionInfo();
  }

  function saveTournamentConfig() {
    tournamentData.name = document.getElementById('tournamentName').value;
    tournamentData.inscriptionPerPlayer = parseFloat(document.getElementById('inscriptionPerPlayer').value) || 0;
    tournamentData.totalInscription = parseFloat(document.getElementById('totalInscription').value) || 0;
    tournamentData.manualMatches = parseInt(document.getElementById('manualMatches').value) || 0;
    
    saveToLocalStorage();
    updateInscriptionInfo();
    alert('‚úÖ Configuraci√≥n guardada exitosamente');
  }

  function updateInscriptionInfo() {
    const perPlayer = tournamentData.inscriptionPerPlayer || 0;
    const total = tournamentData.totalInscription || 0;
    
    document.getElementById("inscriptionInfo").innerHTML = `
      <strong>Valor de Inscripci√≥n:</strong> $${perPlayer.toFixed(0)} COP por jugador<br>
      <strong>Inscripci√≥n Total del Torneo:</strong> $${total.toFixed(0)} COP
    `;
  }

  function exportData() {
    const dataStr = JSON.stringify(tournamentData, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `torneo_${Date.now()}.json`;
    link.click();
  }

  function importData(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const data = JSON.parse(e.target.result);
        tournamentData = data;
        players = data.players || [];
        matches = data.matches || [];
        saveToLocalStorage();
        
        filteredPlayers = [...players];
        filteredMatches = [...matches];
        
        updatePlayersList();
        updateMatchesList();
        updateStatistics();
        loadConfigForm();
        
        alert('‚úÖ Datos importados exitosamente');
      } catch (error) {
        alert('‚ùå Error al importar datos: ' + error.message);
      }
    };
    reader.readAsText(file);
  }

  function resetAllData() {
    if (!confirm('‚ö†Ô∏è ¬øEst√°s ABSOLUTAMENTE SEGURO de que quieres eliminar TODOS los datos? Esta acci√≥n NO se puede deshacer.')) {
      return;
    }
    
    if (!confirm('‚ö†Ô∏è √öLTIMA ADVERTENCIA: Se borrar√°n todos los jugadores, partidos y configuraci√≥n. ¬øContinuar?')) {
      return;
    }

    localStorage.removeItem(currentTournament);
    tournamentData = {
      name: "Torneo Champions",
      inscriptionPerPlayer: 0,
      totalInscription: 0,
      manualMatches: 0,
      players: [],
      matches: []
    };
    players = [];
    matches = [];
    filteredPlayers = [];
    filteredMatches = [];
    
    updatePlayersList();
    updateMatchesList();
    updateStatistics();
    loadConfigForm();
    
    alert('üóëÔ∏è Todos los datos han sido eliminados');
  }

  async function selectTournament(tournamentId) {
    currentTournament = tournamentId;
    loadFromLocalStorage();
    
    filteredPlayers = [...players];
    filteredMatches = [...matches];
    
    updatePlayersList();
    updateMatchesList();
    updateStatistics();
    loadConfigForm();
  }

  // Inicializaci√≥n
  window.addEventListener("load", async () => {
    await selectTournament("torneo1");
  });

  // Cerrar modales al hacer clic fuera
  window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
      event.target.style.display = 'none';
    }
  };
</script>
</body>
</html>